{# --- Toxin Tab Content --- #}
{% if not run_summary.IsControlSystem and run_summary.COM_Mean_Filt is not none %} {# Only show for non-control systems #}
<div class="section">
    <h2>Toxin Interface Analysis</h2>
    <p>Analysis of toxin orientation and contacts with the channel.</p>

    {% if run_summary.IsControlSystem %}
    <div class="info-box">
        Toxin interface analysis is not applicable for control systems.
    </div>
    {% else %}

        <h3>Toxin Orientation & Rotation</h3>
        <div class="two-column">
            <div class="column plot-container">
                <h4>Orientation Angle</h4>
                {% if plots.Toxin_Orientation_Angle %} <img src="data:image/png;base64,{{ plots.Toxin_Orientation_Angle }}" alt="Toxin Orientation Angle"> {% else %} <p><i>Plot not available.</i></p> {% endif %}
            </div>
            <div class="column plot-container">
                <h4>Rotation Components</h4>
                {% if plots.Toxin_Rotation_Components %} <img src="data:image/png;base64,{{ plots.Toxin_Rotation_Components }}" alt="Toxin Rotation Components"> {% else %} <p><i>Plot not available.</i></p> {% endif %}
            </div>
        </div>
        <table class="stats-table">
            <thead><tr><th>Metric</th><th>Value</th></tr></thead>
            <tbody>
                <tr><td>Mean Orientation Angle (°)</td><td>{{ "%.2f"|format(run_summary.Orient_Angle_Mean) if run_summary.Orient_Angle_Mean is not none else 'N/A' }}</td></tr>
                <tr><td>Std Dev Orientation Angle (°)</td><td>{{ "%.2f"|format(run_summary.Orient_Angle_Std) if run_summary.Orient_Angle_Std is not none else 'N/A' }}</td></tr>
                <tr><td>Mean Atom Contacts</td><td>{{ "%.1f"|format(run_summary.Orient_Contacts_Mean) if run_summary.Orient_Contacts_Mean is not none else 'N/A' }}</td></tr>
                <tr><td>Std Dev Atom Contacts</td><td>{{ "%.1f"|format(run_summary.Orient_Contacts_Std) if run_summary.Orient_Contacts_Std is not none else 'N/A' }}</td></tr>
            </tbody>
        </table>

        <h3>Toxin-Channel Contacts</h3>
        <div class="plot-container">
            <h4>Total Contacts Over Time</h4>
            {% if plots.Toxin_Channel_Contacts %} <img src="data:image/png;base64,{{ plots.Toxin_Channel_Contacts }}" alt="Toxin Channel Contacts"> {% else %} <p><i>Plot not available.</i></p> {% endif %}
        </div>
        <table class="stats-table">
            <thead><tr><th>Metric</th><th>Value</th></tr></thead>
            <tbody>
                <tr><td>Mean Atom Contacts</td><td>{{ "%.1f"|format(run_summary.Orient_Contacts_Mean) if run_summary.Orient_Contacts_Mean is not none else 'N/A' }}</td></tr>
                <tr><td>Std Dev Atom Contacts</td><td>{{ "%.1f"|format(run_summary.Orient_Contacts_Std) if run_summary.Orient_Contacts_Std is not none else 'N/A' }}</td></tr>
            </tbody>
        </table>

        <h3>Residue Contact Maps</h3>
        <div class="plot-container">
            <h4>Focused Contact Map (Key Residues)</h4>
            {% if plots.Toxin_Channel_Residue_Contact_Map_Focused %} <img src="data:image/png;base64,{{ plots.Toxin_Channel_Residue_Contact_Map_Focused }}" alt="Focused Residue Contact Map"> {% else %} <p><i>Plot not available.</i></p> {% endif %}
        </div>
        <div class="plot-container">
            <h4>Full Contact Map (All Residues)</h4>
            {% if plots.Toxin_Channel_Residue_Contact_Map_Full %} <img src="data:image/png;base64,{{ plots.Toxin_Channel_Residue_Contact_Map_Full }}" alt="Full Residue Contact Map"> {% else %} <p><i>Plot not available.</i></p> {% endif %}
        </div>

    {% endif %}
</div>
{% elif run_summary.IsControlSystem %}
<div class="section">
    <h2>Toxin Orientation & Interface Analysis</h2>
    <div class="info-box">
        This is a control system without toxin. Orientation and interface analysis is not applicable.
    </div>
</div>
{% else %}
<div class="section">
    <h2>Toxin Orientation & Interface Analysis</h2>
    <p><i>Toxin orientation analysis not performed or data unavailable (check COM analysis).</i></p>
</div>
{% endif %} 